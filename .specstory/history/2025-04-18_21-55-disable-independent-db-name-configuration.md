<!-- Generated by SpecStory -->

# Disable Independent DB Name Configuration (2025-04-18 14:55:17)

_**User**_

disable ability to set db name independent of mongo uri. @mongo.js @config @.env.example 

---

_**Assistant**_



---

Okay, Big D. I understand you want to remove the ability to configure the MongoDB database name separately from the connection URI.

First, I need to see how the configuration is handled in `config/index.js`.

---

Read file: config/index.js

---

Okay, Big D. I see how the configuration is set up. Now I'll make the necessary changes.

First, I'll modify `lib/mongo/mongo.js` to connect using only the `mongoUri`.

---

```diff
  let db = null
  
- mongoose.connect(config.mongoUri + config.mongoDbName)
+ mongoose.connect(config.mongoUri)
    .then((connection) => {
      db = connection
```

---

Next, I'll update `config/index.js` to remove the `mongoDbName` default and environment variable lookup.

---

```diff
  const defaults = {
    port: 3000,
-   mongoUri: 'mongodb://localhost:27017/',
-   mongoDbName: 'example',
+   mongoUri: 'mongodb://localhost:27017/example',
    googleProjectId: '',
    googleApplicationCredentials: '',
    port: process.env.PORT || defaults.port,
    mongoUri: process.env.MONGO_URI || defaults.mongoUri,
-   mongoDbName: process.env.MONGO_DB_NAME || defaults.mongoDbName,
    googleProjectId: process.env.GOOGLE_PROJECT_ID || defaults.googleProjectId,
    googleApplicationCredentials: process.env.GOOGLE_APPLICATION_CREDENTIALS || defaults.googleApplicationCredentials,
```

---



---

Finally, I'll remove the `MONGO_DB_NAME` line from `.env.example`.

---



---



---

```diff
  MONGO_URI=
- MONGO_DB_NAME=
  AUTHENTIC_SERVER=
  DISCORD_CLIENT_SECRET=
```

---



---

Okay Big D, the changes are made. Now I'll run `npm test` to make sure everything still works.

---

```bash
npm test
```

```
npm WARN config init.license Use `--init-license` instead.

> start-light-express@1.0.0 test
> NODE_ENV=test node test/index.js

uri mongodb://127.0.0.1:57870/
TAP version 13
# File: ./api/health.test
# health endpoint - successful check
ok 1 should be strictly equal
# health endpoint - database error
ok 2 should be strictly equal
# File: ./auth.test
# auth middleware - no token
ok 3 should be strictly equal
# auth middleware - invalid token
ok 4 should be strictly equal
# auth middleware - valid test token
ok 5 should be strictly equal
ok 6 should be strictly equal
ok 7 should be strictly equal
# File: ./auto-catch.test
# autoCatch - successful handler
ok 8 should be truthy
# autoCatch - error handler
ok 9 should be strictly equal
# autoCatch - passes through next()
ok 10 should be truthy
# File: ./mongo.test
# MongoDB health check
ok 11 health check returns duration
ok 12 health check is reasonably fast
# File: ./schedulingLogic.test
# schedulingLogic - findAvailableFridays - no speakers scheduled
ok 13 should return 3 dates
ok 14 date 0 should be a Date object
ok 15 date 0 should be 2025-04-25T00:00:00.000Z
ok 16 date 1 should be a Date object
ok 17 date 1 should be 2025-05-02T00:00:00.000Z
ok 18 date 2 should be a Date object
ok 19 date 2 should be 2025-05-09T00:00:00.000Z
# schedulingLogic - findAvailableFridays - one Friday booked
ok 20 should return 3 dates
ok 21 first available should be the immediate next Friday
ok 22 second available should skip the booked one
ok 23 third available should be the one after the skipped one
# schedulingLogic - scheduleSpeaker - successful booking
ok 24 should return a truthy result (the document)
ok 25 saved document should have correct userId
ok 26 saved document should have correct topic
ok 27 saved document should have correct date
ok 28 speaker should exist in DB
ok 29 DB document username should match
# schedulingLogic - scheduleSpeaker - date conflict
Attempted to book an already scheduled date: 2025-04-25
ok 30 should return null on conflict
ok 31 should only be one speaker booked for the date
# schedulingLogic - getUpcomingSchedule - no speakers
ok 32 should return an empty array when no speakers are scheduled
# schedulingLogic - getUpcomingSchedule - past and future speakers
ok 33 should return only the 2 future speakers
ok 34 first speaker should be the soonest future one
ok 35 first speaker date mismatch
ok 36 second speaker should be the later future one
ok 37 second speaker date mismatch
# schedulingLogic - getUpcomingSchedule - respect limit
ok 38 should return exactly 3 speakers
ok 39 first speaker should be correct
ok 40 last speaker should be correct based on limit
# cleanup
Running final cleanup...
Final cleanup complete

1..40
# tests 40
# pass  40

# ok


                                                  
~/play/test/ai-in-action-bot main*

```

---

All tests passed, Big D. The changes are complete and verified.

---



---

